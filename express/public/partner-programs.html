<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Raymoch • Partner Programs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* =========================================================
       RAYMOCH — FROZEN HEADER/FOOTER + SLIP-PROTECTION
       ========================================================= */
    :root{
      /* Brand */
      --brand-blue:#0328aeed; --brand-gold:#7a7797a8;

      /* Surfaces & text */
      --bg:#fafafa; --card:#ffffff; --ink:#101114; --muted:#475569; --border:#e8e8ee;

      /* Effects & radii */
      --shadow:0 6px 22px rgba(10,42,107,.08);
      --radius:16px; --radius-pill:999px;

      /* Layout */
      --gutter:18px; --maxw:1328px;

      /* Header palette */
      --nav-brand:#0328aeed; --nav-link:#0f172a; --nav-hover:#0a2a6b;
      --nav-bg:#ffffff; --nav-fg:#101114; --border-soft:#e8e8ee;

      /* Footer canvas */
      --footer-bg:#0b1020;
    }

    *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif}

    /* ===== Slip-protection: no white flash under footer on iOS rubber-band ===== */
    html{ background:var(--footer-bg); height:100%; }

    body{
      color:var(--ink);
      line-height:1.5;
      min-height:100dvh;
      display:flex;
      flex-direction:column;
      overscroll-behavior-y:none;
      /* fade page bg to footer bg near bottom */
      background:
        linear-gradient(to bottom,
          var(--bg) 0%,
          var(--bg) calc(100% - 240px),
          var(--footer-bg) calc(100% - 240px),
          var(--footer-bg) 100%);
    }
    /* iOS safe-area guard (keeps very bottom dark) */
    body::after{
      content:"";
      position:fixed;
      inset:auto 0 0 0;
      height:env(safe-area-inset-bottom, 0);
      background:var(--footer-bg);
      pointer-events:none;
      z-index:1;
    }

    main{flex:1}
    a{text-decoration:none;color:inherit}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 var(--gutter)}
    .container{max-width:1160px;margin:0 auto;padding:24px}

    /* ================= HEADER (Tier1 + Tier2) — FROZEN ================= */
    .header{
      background:var(--nav-bg); color:var(--nav-fg);
      position:sticky; top:0; z-index:1000; border-bottom:1px solid var(--border-soft)
    }
    .row1{
      display:flex;justify-content:space-between;align-items:center;gap:16px;
      padding:12px 8px; margin:15px; box-shadow:0 1px 0 rgba(0,0,0,.05); position:relative;
      background:#fff; border-radius:12px;
    }
    .brandrow{display:flex;align-items:center;gap:22px}
    .brand{display:flex;align-items:center;gap:10px;color:var(--nav-brand)}
    .brand-word{font-weight:900;font-size:1.4rem;color:var(--nav-brand);letter-spacing:.2px}
    .dotgrid{width:18px;height:18px;display:inline-grid;grid-template-columns:repeat(2,1fr);gap:2px}
    .dotgrid i{width:5px;height:5px;border-radius:2px;background:#101114}
    .rightside{display:flex;align-items:center;gap:14px}
    .search-box{min-width:140px;width:18vw;max-width:260px}
    .search-box input{width:100%;height:40px;padding:0 14px;border:1px solid var(--border-soft);border-radius:var(--radius-pill)}
    .search-box input:focus{border-color:var(--nav-brand);outline:2px solid #cfe0ff}
    .header .btn{height:40px;display:inline-flex;align-items:center;gap:8px;padding:0 16px;border-radius:var(--radius-pill);font-weight:700;background:#fff;border:1px solid var(--border-soft);cursor:pointer}
    .header .btn.primary{background:var(--nav-brand);color:#fff;border-color:var(--nav-brand)}

    .explore-toggle{
      appearance:none;border:0;background:transparent;cursor:pointer;
      display:flex;align-items:center;gap:8px;font-weight:800;color:var(--nav-link);
      padding:6px 8px;border-radius:8px;font-size:1.1rem;
    }
    .explore-toggle:hover,
    .explore-toggle[aria-expanded="true"]{ background:#eceff3;color:var(--nav-hover); }

    .menu-panel{
      position:absolute; top:calc(100% + 10px); left:15px; z-index:1100;
      width:min(760px, calc(100vw - 40px));
      background:#fff;border:1px solid var(--border-soft);border-radius:14px;box-shadow:var(--shadow);
      padding:14px;
    }
    .menu-panel[hidden]{ display:none; }
    .menu-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .menu-head h4{margin:0;font-size:1rem}
    .menu-grid{display:grid;grid-template-columns:repeat(2,minmax(240px,1fr));gap:12px}
    .menu-item{display:block;padding:12px;border:1px solid var(--border-soft);border-radius:12px;background:#fff}
    .menu-item:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(0,0,0,.06)}
    .menu-item h5{margin:0 0 6px;font-size:.98rem}
    .menu-item p{margin:0;color:#3c4b69;font-size:.92rem}

    .row2{background:#f5f6f8;border-top:1px solid #eee;border-bottom:1px solid #e6e6e6;padding-left:15px}
    .row2 .wrap{max-width:none;padding:0}
    .row2 .links{display:flex;gap:18px;padding:8px 8px;margin:0;justify-content:flex-start;align-items:center}
    .row2 a{font-weight:600;font-size:.92rem;padding:4px 6px;border-radius:4px;color:var(--nav-link)}
    .row2 a:hover{background:#eceff3;color:var(--nav-hover)}
    #site-header a.active{font-weight:600;text-decoration:underline}

    @media (max-width:800px){ .search-box{width:34vw;max-width:300px} }
    @media (max-width:720px){ .row2{display:none} .search-box{min-width:0;width:46vw} }

    .header a:focus-visible, .header button:focus-visible, .btn:focus-visible {
      outline: 2px solid #cfe0ff; outline-offset: 2px;
    }

    /* ================== HERO (kept) ================== */
    .hero{background:var(--brand-blue);color:#fff;padding:36px 0 18px}
    .hero h2{margin:0 0 8px;font-size:40px;font-weight:900}
    .hero p{margin:0;color:#e5ecff;max-width:820px}

    /* ================== Page UI (kept) ================== */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .col-4{grid-column:span 4}
    .card{border:1px solid var(--border);border-radius:20px;background:var(--card);padding:20px;box-shadow:var(--shadow)}
    .card h3{margin:0 0 6px;font-size:18px;color:#0328aeed}
    .card p{margin:6px 0 0;color:var(--muted)}
    .card.click{cursor:pointer}
    .card.click:hover{transform:translateY(-2px);box-shadow:0 14px 36px rgba(6,60,168,.12)}
    .meta{color:#6b7280;font-size:14px}
    .badge{display:inline-block;border:1px solid var(--border);border-radius:10px;padding:4px 8px;font-size:12px;margin-right:6px;background:#f9fafb}

    .route{display:none}
    .route.active{display:block}

    .filterbar{display:flex;gap:12px;align-items:center;margin:12px 0 14px;flex-wrap:wrap}
    .filterbar select,.filterbar input{border:1px solid var(--border);border-radius:12px;padding:8px 12px;font-size:15px}
    .filterbar input{flex:1;min-width:200px}
    .filterbar .reset{border:0;background:#fff;border:1px solid var(--border);border-radius:12px;padding:8px 14px;font-weight:700;cursor:pointer}

    /* ================= FOOTER — FROZEN ================= */
    footer{margin-top:auto;background:var(--footer-bg);color:#cbd5e1;}
    @media (max-width: 860px){
      footer .wrap > div[style*="grid-template-columns"]{
        display:grid;grid-template-columns:1fr;gap:16px !important;
      }
    }
  </style>
</head>
<body>

  <!-- ================== HEADER (FROZEN) ================== -->
  <header class="header" id="site-header">
    <div class="row1">
      <div class="brandrow">
        <a class="brand" href="Entire.html" aria-label="Raymoch home">
          <svg width="28" height="28" viewBox="0 0 200 200" aria-hidden="true">
            <polygon fill="none" stroke="currentColor" stroke-width="10" points="100,18 172,59 172,141 100,182 28,141 28,59"/>
            <text x="100" y="118" text-anchor="middle" style="fill:currentColor;font:700 105px Georgia">R</text>
          </svg>
          <span class="brand-word">Raymoch</span>
        </a>

        <button class="explore-toggle" id="exploreToggle" aria-haspopup="true" aria-expanded="false">
          <span class="dotgrid" aria-hidden="true"><i></i><i></i><i></i><i></i></span>
          Explore
        </button>

        <div class="menu-panel" id="t1Menu" role="menu" aria-labelledby="exploreToggle" hidden>
          <div class="menu-head"><h4>Explore services</h4></div>
          <div class="menu-grid">
            <a class="menu-item" href="Matching.html"><h5>Trusted Matching</h5><p>Get paired with credible businesses using CTI & verification.</p></a>
            <a class="menu-item" href="verification.html"><h5>Verification</h5><p>CTI badges, document checks, and data provenance.</p></a>
            <a class="menu-item" href="Market_Insight.html"><h5>Research & Insights</h5><p>Sector reports, trends, and regional briefs.</p></a>
            <a class="menu-item" href="Services.html"><h5>Programs & Services</h5><p>Advisory, partner programs, and support options.</p></a>
            <a class="menu-item" href="incentives.html"><h5>Policy & Incentives</h5><p>Tax credits, grants, and regulatory signals.</p></a>
            <a class="menu-item" href="whitespace.html"><h5>Whitespace Map</h5><p>Where demand outpaces supply across sectors.</p></a>
          </div>
        </div>
      </div>

      <div class="rightside">
        <form class="search-box" action="search.html">
          <input id="navSearch" type="search" name="q" placeholder="Search companies, sectors, regions…" />
        </form>
        <div class="auth">
          <button class="btn" type="button" onclick="location.href='login.html'">Log in</button>
          <button class="btn primary" type="button" onclick="location.href='signup.html'">Sign up</button>
        </div>
      </div>
    </div>

    <div class="row2">
      <div class="wrap">
        <nav class="links" aria-label="Secondary">
          <a href="explore2.html">Businesses</a>
          <a href="Services.html">Services</a>
          <a href="Market_Insight.html">Research &amp; Insights</a>
          <a href="About.html">Who We Are</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- ================== HERO (unchanged) ================== -->
  <div class="hero">
    <div class="container">
      <h2>Partner Programs</h2>
      <p>Discover official programs, subsidies, and opportunities for African businesses.</p>
    </div>
  </div>

  <main>
    <div class="container">
      <!-- STEP 1: CHOOSE PATH -->
      <section class="route active" data-route="programs" aria-labelledby="chooseTitle">
        <h3 id="chooseTitle" style="color:var(--brand-blue)">Choose a partner path</h3>
        <div class="filterbar" id="lpFilterbar" role="search" style="margin-top:8px">
          <input id="lpQuery" type="search" placeholder="Search by name, sponsor, sector" aria-label="Search programs on landing" />
          <select id="lpCategory" aria-label="Program type (landing)"></select>
          <select id="lpCountry" aria-label="Country (landing)"></select>
          <button class="reset" id="lpSearchBtn" type="button">Search</button>
        </div>
        <div class="grid" style="margin-top:16px">
          <article class="card col-4 click" data-type="accelerator" tabindex="0" role="button" aria-label="Accelerator Partner">
            <h3>Accelerator Partner</h3>
            <p class="meta">Cohort pipelines • Verified profiles</p>
          </article>
          <article class="card col-4 click" data-type="syndicate" tabindex="0" role="button" aria-label="Syndicate Partner">
            <h3>Syndicate Partner</h3>
            <p class="meta">Dealrooms • Referral tracking</p>
          </article>
          <article class="card col-4 click" data-type="ecosystem" tabindex="0" role="button" aria-label="Ecosystem Partner">
            <h3>Ecosystem Partner</h3>
            <p class="meta">Directory sync • Member verification</p>
          </article>
        </div>
      </section>

      <!-- STEP 2: CATALOG -->
      <section class="route" data-route="catalog" aria-labelledby="catalogTitle">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h3 id="catalogTitle" style="color:var(--brand-blue);margin:0">Programs</h3>
          <button class="btn secondary" id="backToChoices" type="button" aria-label="Back to choices">← Back</button>
        </div>

        <div class="filterbar" role="search">
          <input id="catQuery" type="search" placeholder="Search by name, sponsor, sector" aria-label="Search catalog" />
          <select id="catCategory" aria-label="Program type"></select>
          <select id="catCountry" aria-label="Country"></select>
          <button class="reset" id="catReset" type="button">Clear</button>
        </div>

        <div class="grid" id="cards" aria-live="polite"></div>
        <div id="emptyState" style="display:none;margin:24px 0;color:#6b7280">No programs match your filters.</div>
      </section>

      <!-- STEP 3: DETAILS -->
      <section class="route" data-route="details" aria-labelledby="detailTitle">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h3 id="detailTitle" style="color:var(--brand-blue);margin:0">Program Information</h3>
          <div>
            <button class="btn secondary" id="backToCatalog" type="button">← Back to list</button>
            <button class="btn" id="toEligibility" type="button">Check eligibility</button>
          </div>
        </div>
        <div id="progDetail" class="card"></div>
      </section>

      <!-- STEP 4: ELIGIBILITY -->
      <section class="route" data-route="eligibility" aria-labelledby="eligTitle">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h3 id="eligTitle" style="color:var(--brand-blue);margin:0">Eligibility</h3>
          <button class="btn secondary" id="backToDetails" type="button">← Back to program</button>
        </div>

        <form id="eligForm" class="card" novalidate>
          <div class="grid">
            <div class="col-4" style="grid-column:span 6">
              <label>Organization Name
                <input name="org" type="text" required
                  style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%" />
              </label>

              <label>Contact Email
                <input name="email" type="email" required
                  style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%" />
              </label>

              <label>Country (AU 55)
                <select name="country" required id="eligCountry"
                  style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%"></select>
              </label>
            </div>

            <div class="col-4" style="grid-column:span 6">
              <label id="typeSpecific1"></label>
              <label id="typeSpecific2"></label>
              <label id="typeSpecific3"></label>
            </div>
          </div>

          <div style="margin-top:12px">
            <button class="btn" type="submit">Submit Application</button>
          </div>
        </form>
      </section>
    </div>
  </main>

  <!-- ================== FOOTER (FROZEN) ================== -->
  <footer class="footer" id="site-footer">
    <div class="wrap" style="padding:32px var(--gutter)">
      <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:18px">
        <div>
          <div style="color:#fff;font-weight:800;font-size:1.2rem;margin-bottom:8px">Raymoch</div>
          <div style="color:#94a3b8;max-width:360px">
            Connecting investors and entrepreneurs through trust, verified data, and actionable insights.
          </div>
        </div>
        <div>
          <h5 style="margin-bottom:10px;color:#e5e7eb;font-size:.95rem">Company</h5>
          <a href="About.html" style="display:block;color:#cbd5e1;margin:6px 0">About</a>
          <a href="careers.html" style="display:block;color:#cbd5e1;margin:6px 0">Careers</a>
          <a href="press.html" style="display:block;color:#cbd5e1;margin:6px 0">Press</a>
          <a href="contact.html" style="display:block;color:#cbd5e1;margin:6px 0">Contact</a>
        </div>
        <div>
          <h5 style="margin-bottom:10px;color:#e5e7eb;font-size:.95rem">Product</h5>
          <a href="explore2.html" style="display:block;color:#cbd5e1;margin:6px 0">Explore Businesses</a>
          <a href="Market_Insight.html" style="display:block;color:#cbd5e1;margin:6px 0">Market Insights</a>
          <a href="verification.html" style="display:block;color:#cbd5e1;margin:6px 0">Verification</a>
          <a href="Services.html" style="display:block;color:#cbd5e1;margin:6px 0">Programs & Services</a>
        </div>
        <div>
          <h5 style="margin-bottom:10px;color:#e5e7eb;font-size:.95rem">Resources</h5>
          <a href="blog.html" style="display:block;color:#cbd5e1;margin:6px 0">Blog</a>
          <a href="help.html" style="display:block;color:#cbd5e1;margin:6px 0">Help Center</a>
          <a href="security.html" style="display:block;color:#cbd5e1;margin:6px 0">Security</a>
          <a href="status.html" style="display:block;color:#cbd5e1;margin:6px 0">Status</a>
        </div>
      </div>
      <div style="border-top:1px solid #1f2937;margin-top:22px;padding:12px 0;display:flex;justify-content:space-between;align-items:center;font-size:.92rem">
        <div>© <span id="footerYear"></span> Raymoch. All rights reserved.</div>
        <div>
          <a href="privacy.html" style="color:#cbd5e1;margin-left:14px">Privacy</a>
          <a href="terms.html" style="color:#cbd5e1;margin-left:14px">Terms</a>
          <a href="cookies.html" style="color:#cbd5e1;margin-left:14px">Cookies</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- ================== SCRIPTS ================== -->
  <script>
    // Header: Explore dropdown + active link (frozen)
    (function(){
      const btn = document.getElementById('exploreToggle');
      const menu = document.getElementById('t1Menu');
      if(btn && menu){
        const toggle = (open)=>{ btn.setAttribute('aria-expanded', open?'true':'false'); menu.hidden = !open; };
        btn.addEventListener('click', e=>{ e.preventDefault(); toggle(menu.hidden); });
        document.addEventListener('click', e=>{ if(!menu.hidden && !menu.contains(e.target) && !btn.contains(e.target)) toggle(false); });
        document.addEventListener('keydown', e=>{ if(e.key==='Escape') toggle(false); });
      }
      const current = location.pathname.split('/').pop() || 'Entire.html';
      document.querySelectorAll('#site-header a[href]').forEach(a=>{
        const href = a.getAttribute('href'); if(href && href === current) a.classList.add('active');
      });
    })();

    // Footer: dynamic year
    (function(){
      const y=document.getElementById('footerYear'); if(y) y.textContent = new Date().getFullYear();
    })();
  </script>

  <script>
    // ---------- Helpers ----------
    const $  = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));
    const cap = (s)=>s ? s.charAt(0).toUpperCase()+s.slice(1) : '';

    // ---------- Router ----------
    const routes = ['programs','catalog','details','eligibility'];
    function go(route){
      $$('.route').forEach(x=>x.classList.remove('active'));
      const target = document.querySelector(`.route[data-route="${route}"]`);
      if(target){ target.classList.add('active'); window.scrollTo({top:0, behavior:'instant'}); }
    }

    // ---------- Data ----------
    const PROGRAMS = [
      {id:'undp-youth', name:'Youth Entrepreneurship', sponsor:'UNDP', type:'accelerator', category:'Youth', sector:'Multi-sector', country:'Ethiopia', deadline:'Jul 2024', info:'UNDP-backed program fostering youth-led startups with mentorship, stipends and market linkages.'},
      {id:'green-founders', name:'Green Founders Bootcamp', sponsor:'Regional', type:'accelerator', category:'Green/Climate', sector:'Energy', country:'Kenya', deadline:'Nov 2025', info:'Bootcamp for climate-focused SMEs; includes verification fast-lane and pilot partners.'},
      {id:'diaspora-co-invest', name:'Diaspora Co-Invest Window', sponsor:'Investor Syndicate', type:'syndicate', category:'Investment/Syndicate', sector:'Multi-sector', country:'Nigeria', deadline:'Rolling', info:'Co-invest vehicle for diaspora angels; thesis-aligned dealrooms and referral attribution.'},
      {id:'afdb-export', name:'Small Business Export Support', sponsor:'African Development Bank', type:'syndicate', category:'Export Support', sector:'Manufacturing', country:'Kenya', deadline:'Mar 2026', info:'Export-readiness audits, certification support and buyer introductions.'},
      {id:'ngr-agribiz', name:'Agribusiness Investment Grant', sponsor:'Government of Nigeria', type:'ecosystem', category:'Grant', sector:'Agriculture', country:'Nigeria', deadline:'May 2025', info:'Capital grants for agribusiness SMEs; paired with market linkages.'},
      {id:'women-tech', name:'Women in Tech Initiative', sponsor:'NGO', type:'ecosystem', category:'Women', sector:'Technology', country:'Ghana', deadline:'Sep 2024', info:'Initiative to boost women participation and leadership in African tech.'},
      {id:'sme-renew', name:'SME Renewable Energy Subsidy', sponsor:'Regional Program', type:'ecosystem', category:'Subsidy', sector:'Energy', country:'Multi-country', deadline:'Dec 2025', info:'Hardware/CapEx subsidy for SME solar adoption; fast verification path for partners.'}
    ];

    const AU55 = [
      "Algeria","Angola","Benin","Botswana","Burkina Faso","Burundi","Cabo Verde","Cameroon",
      "Central African Republic","Chad","Comoros","Republic of the Congo","Côte d’Ivoire","Djibouti",
      "Democratic Republic of the Congo","Egypt","Equatorial Guinea","Eritrea","Eswatini",
      "Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau","Kenya","Lesotho",
      "Liberia","Libya","Madagascar","Malawi","Mali","Mauritania","Mauritius","Morocco",
      "Mozambique","Namibia","Niger","Nigeria","Rwanda","Sahrawi Arab Democratic Republic",
      "São Tomé and Príncipe","Senegal","Seychelles","Sierra Leone","Somalia","South Africa",
      "South Sudan","Sudan","Tanzania","Togo","Tunisia","Uganda","Zambia","Zimbabwe"
    ];

    const state = { type:null, program:null };

    // ---------- Step 1 ----------
    function attachCardHandlers(){
      $$('.card.click[data-type]').forEach(card=>{
        card.addEventListener('click', ()=>{ state.type = card.dataset.type; renderCatalog(); go('catalog'); });
        card.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); state.type = card.dataset.type; renderCatalog(); go('catalog'); } });
      });
    }
    attachCardHandlers();
    ensureFiltersPopulatedOnce();
    populatePathCards();

    // ---------- Catalog / Filters ----------
    function ensureFiltersPopulatedOnce(){
      const typeEl = $('#catCategory');
      const ctryEl = $('#catCountry');
      const lpTypeEl = $('#lpCategory');
      const lpCtryEl = $('#lpCountry');

      const computedCats = Array.from(new Set([...PROGRAMS.map(p=>p.category), 'Women','Youth']))
        .filter(Boolean).sort((a,b)=>a.localeCompare(b));
      const catOptions = ['All program types', ...computedCats]
        .map(x=>`<option>${x}</option>`).join('');

      if(typeEl && typeEl.options.length === 0){ typeEl.innerHTML = catOptions; }
      if(lpTypeEl && lpTypeEl.options.length === 0){ lpTypeEl.innerHTML = catOptions; }

      const countryOptions = ['All countries (55)', ...AU55]
        .map(c=>`<option>${c}</option>`).join('');
      if(ctryEl && ctryEl.options.length === 0){ ctryEl.innerHTML = countryOptions; }
      if(lpCtryEl && lpCtryEl.options.length === 0){ lpCtryEl.innerHTML = countryOptions; }
    }

    function populatePathCards(){
      const types = ['accelerator','syndicate','ecosystem'];
      types.forEach(t=>{
        const card = document.querySelector(`.card.click[data-type="${t}"]`);
        if(!card) return;
        const items = PROGRAMS.filter(p=>p.type===t).slice(0,2);
        const count = PROGRAMS.filter(p=>p.type===t).length;
        const list = items.map(p=>`<li>${p.name} <span class="meta">• ${p.country}</span></li>`).join('');
        const badge = `<span class="badge">${count} program${count!==1?'s':''}</span>`;
        if(!card.querySelector('ul')){
          const ul = document.createElement('ul');
          ul.className='meta';
          ul.style.marginTop='8px';
          ul.innerHTML = list || '<li>No programs yet</li>';
          card.appendChild(ul);
          const b = document.createElement('div');
          b.style.marginTop='8px';
          b.innerHTML = badge;
          card.appendChild(b);
        }
      });
    }

    function renderCatalog(){
      ensureFiltersPopulatedOnce();
      document.getElementById('catalogTitle').textContent = `${cap(state.type||'All')} Programs`;

      const q     = (document.getElementById('catQuery').value||'').trim().toLowerCase();
      const cat   = document.getElementById('catCategory').value || 'All program types';
      const ctry  = document.getElementById('catCountry').value  || 'All countries (55)';

      const cards = document.getElementById('cards');
      cards.innerHTML = '';

      const result = PROGRAMS.filter(p=>{
        const matchesPath = !state.type || p.type === state.type;
        const text = `${p.name} ${p.sponsor} ${p.category} ${p.sector} ${p.country}`.toLowerCase();
        const hitsQuery = !q || text.includes(q);
        const hitsType  = (cat === 'All program types') || p.category === cat;
        const hitsCtry  = (ctry.startsWith('All countries')) || p.country === ctry || p.country === 'Multi-country';
        return matchesPath && hitsQuery && hitsType && hitsCtry;
      });

      document.getElementById('emptyState').style.display = result.length ? 'none' : 'block';

      result.forEach(p=>{
        const el = document.createElement('article');
        el.className = 'card col-4 click';
        el.innerHTML = `
          <h3>${p.name}</h3>
          <p class="meta">${p.sponsor} • ${p.country}</p>
          <span class="badge">${p.category}</span>
          <span class="badge">${p.sector}</span>
          <span class="badge">Deadline: ${p.deadline}</span>`;
        el.addEventListener('click', ()=>{ state.program = p; renderDetails(); go('details'); });
        el.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); state.program = p; renderDetails(); go('details'); } });
        cards.appendChild(el);
      });
    }

    // Filter events
    document.getElementById('catQuery').addEventListener('input', renderCatalog);
    document.getElementById('catCategory').addEventListener('change', renderCatalog);
    document.getElementById('catCountry').addEventListener('change', renderCatalog);
    document.getElementById('catReset').addEventListener('click', ()=>{
      document.getElementById('catQuery').value = '';
      document.getElementById('catCategory').selectedIndex = 0;
      document.getElementById('catCountry').selectedIndex = 0;
      renderCatalog();
    });

    // Landing search → push to catalog
    document.getElementById('lpSearchBtn').addEventListener('click', ()=>{
      state.type = null;
      go('catalog');
      ensureFiltersPopulatedOnce();
      document.getElementById('catQuery').value = document.getElementById('lpQuery').value || '';
      document.getElementById('catCategory').value = document.getElementById('lpCategory').value || 'All program types';
      document.getElementById('catCountry').value = document.getElementById('lpCountry').value || 'All countries (55)';
      renderCatalog();
    });
    document.getElementById('lpQuery').addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){ e.preventDefault(); document.getElementById('lpSearchBtn').click(); }
    });

    // Back buttons
    document.getElementById('backToChoices').addEventListener('click', ()=>{ state.type = null; go('programs'); });
    document.getElementById('backToCatalog').addEventListener('click', ()=> go('catalog'));

    // Details & Eligibility
    function renderDetails(){
      if(!state.program) return;
      document.getElementById('detailTitle').textContent = state.program.name;
      document.getElementById('progDetail').innerHTML = `
        <p class="meta"><strong>Path:</strong> ${cap(state.program.type)} • <strong>Program type:</strong> ${state.program.category}</p>
        <p class="meta"><strong>Sponsor:</strong> ${state.program.sponsor} • <strong>Country:</strong> ${state.program.country} • <strong>Sector:</strong> ${state.program.sector}</p>
        <p>${state.program.info}</p>
        <p class="meta">Deadline: ${state.program.deadline}</p>
      `;
      document.getElementById('eligTitle').textContent = `Eligibility — ${state.program.name}`;
    }

    document.getElementById('toEligibility').addEventListener('click', ()=>{ renderEligibility(); go('eligibility'); });
    document.getElementById('backToDetails').addEventListener('click', ()=> go('details'));

    function renderEligibility(){
      const AU55 = [
        "Algeria","Angola","Benin","Botswana","Burkina Faso","Burundi","Cabo Verde","Cameroon",
        "Central African Republic","Chad","Comoros","Republic of the Congo","Côte d’Ivoire","Djibouti",
        "Democratic Republic of the Congo","Egypt","Equatorial Guinea","Eritrea","Eswatini",
        "Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau","Kenya","Lesotho",
        "Liberia","Libya","Madagascar","Malawi","Mali","Mauritania","Mauritius","Morocco",
        "Mozambique","Namibia","Niger","Nigeria","Rwanda","Sahrawi Arab Democratic Republic",
        "São Tomé and Príncipe","Senegal","Seychelles","Sierra Leone","Somalia","South Africa",
        "South Sudan","Sudan","Tanzania","Togo","Tunisia","Uganda","Zambia","Zimbabwe"
      ];
      const cSel = document.getElementById('eligCountry');
      if(cSel.options.length === 0){ cSel.innerHTML = AU55.map(c=>`<option>${c}</option>`).join(''); }

      const ts1 = document.getElementById('typeSpecific1');
      const ts2 = document.getElementById('typeSpecific2');
      const ts3 = document.getElementById('typeSpecific3');
      ts1.innerHTML = ts2.innerHTML = ts3.innerHTML = '';

      const t = state.program?.type || state.type || 'ecosystem';
      if(t === 'accelerator'){
        ts1.innerHTML = 'Startups per year <input name="aCount" type="number" min="0" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%">';
        ts2.innerHTML = 'Named program lead? <select name="aLead" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%"><option value="">Select</option><option>Yes</option><option>No</option></select>';
        ts3.innerHTML = 'Data-sharing consent? <select name="aConsent" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%"><option value="">Select</option><option>Yes</option><option>No</option></select>';
      } else if(t === 'syndicate'){
        ts1.innerHTML = 'Active members <input name="sCount" type="number" min="0" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%">';
        ts2.innerHTML = 'Compliance owner? <select name="sComp" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%"><option value="">Select</option><option>Yes</option><option>No</option></select>';
        ts3.innerHTML = 'Documented thesis? <select name="sThesis" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%"><option value="">Select</option><option>Yes</option><option>No</option></select>';
      } else {
        ts1.innerHTML = 'Member businesses <input name="eCount" type="number" min="0" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%">';
        ts2.innerHTML = 'Named coordinator? <select name="eCoord" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%"><option value="">Select</option><option>Yes</option><option>No</option></select>';
        ts3.innerHTML = 'Roster CSV available? <select name="eRoster" required style="padding:10px;border:1px solid var(--border);border-radius:12px;width:100%"><option value="">Select</option><option>Yes</option><option>No</option></select>';
      }
    }

    document.getElementById('eligForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      alert('Application submitted. We’ll follow up by email.');
      go('programs');
    });

    // Global nav search → jump to catalog
    document.getElementById('navSearch').addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        e.preventDefault();
        state.type = null;
        go('catalog');
        setTimeout(()=>{
          document.getElementById('catQuery').value = e.target.value || '';
          renderCatalog();
        }, 0);
      }
    });

    // Deep-link
    if(location.hash.includes('/programs')){ go('programs'); }
  </script>
</body>
</html>
